## Load balancing
## Lists each backend instance and its instances
#upstream server1-backend {
#	server http://localhost:2001; # 1st server1 instance
#	server http://localhost:2002; # 2nd server1 instance
#}

upstream server2-nodes {
	server server2:3001; # 1st server2 instance
	#server http://localhost:3002; # 2nd server2 instance
	keepalive 64;
}

## Proxy server
## Delegates requests to network
server {
	listen 80;
	server_name localhost;
}

server {
	listen 80;
	server_name server2.localhost;

	## Pass requests through reverse proxy
	## Requests will be subsuequently delegated as nginx decides
	#location /server1 {
	#	proxy_pass http://server2;
	#	proxy_http_version 1.1;
	#	proxy_set_header Upgrade $http_upgrade;
	#	proxy_set_header Host $host;
	#	proxy_cache_bypass $http_upgrade;
	#}

	location / {
		proxy_pass http://server2-nodes;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Host $host;
		proxy_cache_bypass $http_upgrade;
	}
}