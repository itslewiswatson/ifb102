## Load balancing
## Lists each backend instance and its instances
#upstream server1-backend {
#	server http://localhost:2001; # 1st server1 instance
#	server http://localhost:2002; # 2nd server1 instance
#}

upstream server2 {
	server 127.0.0.1:9453; # 1st server2 instance
	#server http://localhost:3002; # 2nd server2 instance
	keepalive 64;
}

## Proxy server
## Delegates requests to network
server {
	listen 80;
	server_name localhost;

	location /a {
		proxy_pass http://google.com/;
	}

	## Pass requests through reverse proxy
	## Requests will be subsuequently delegated as nginx decides
	location /server1 {
		proxy_pass http://server2;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Host $host;
		proxy_cache_bypass $http_upgrade;
	}

	# Rewrite without URL being weird
	location = /en {
		return 302 /server2/;
	}
	location /server2/ {
		proxy_pass http://server2;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Host $host;
		proxy_cache_bypass $http_upgrade;
	}
}